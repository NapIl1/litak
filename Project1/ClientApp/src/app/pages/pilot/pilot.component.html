<div class="nav-left-sidebar sidebar-dark">
    <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 100%;">
        <div class="menu-list" style="overflow: hidden; width: auto; height: 100%;">
            <nav class="navbar navbar-expand-lg navbar-light">
                <a class="d-xl-none d-lg-none">Вильоти</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">



                    <ul class="navbar-nav flex-column">

                        <li class="nav-divider _nav-sidebar">
                            Навігація
                        </li>
                        
                        <li *ngIf="userInfo.role == userRoles.ADMIN" a class="nav-item _nav-sidebar">
                            <a routerLink="/admin" class="nav-link nav-icons" href="#">
                                <i class="fas fa-fw fa-cog"></i>
                                Адмін
                            </a>
                        </li>
        
                        <li *ngIf="userInfo.role == userRoles.PPO" class="nav-item _nav-sidebar">
                            <a routerLink="/ppo" class="nav-link nav-icons" href="#">
                                <i class="fas fa-fw fa-rocket"></i>
                                ППО
                            </a>
                        </li>
        
                        <li *ngIf="userInfo.role == userRoles.REB" class="nav-item _nav-sidebar">
                            <a routerLink="/ppo" class="nav-link nav-icons" href="#">
                                <i class="fas fa-fw fa-rocket"></i>
                                РЕБ
                            </a>
                        </li>
        
                        <li *ngIf="userInfo.role == userRoles.ADMIN" class="nav-item _nav-sidebar">
                            <a routerLink="/ppo" class="nav-link nav-icons" href="#">
                                <i class="fas fa-fw fa-rocket"></i>
                                ППО/РЕБ
                            </a>
                        </li>
        
                        <li *ngIf="userInfo.role == userRoles.ADMIN || userInfo.role == userRoles.PILOT" class="nav-item _nav-sidebar">
                            <a routerLink="/new-flight" class="nav-link nav-icons" href="#">
                                <i class="fas fa-fw fa-user"></i>
                                Пілот
                            </a>
                        </li>

                        <li class="nav-divider">
                            Вильоти
                        </li>
                        <li class="nav-item ">
                            <a [ngClass]="{active: isNewFlight}" class="nav-link" (click)="newFlight()">
                                <i class="fas fa-plus"></i>
                                Новий виліт
                            </a>
                        </li>
                        <li *ngFor="let item of flights" class="nav-item" [routerLink]="['/flight', item._id]">
                        <a [ngClass]="{active: flight._id == item._id}" class="nav-link" >
                            <i *ngIf="item.flightStep.isApproved && !item.isRejected" class="fas fa-check-circle text-success"></i>
                            <i *ngIf="!item.flightStep.isApproved && !item.isRejected" class="fas fa-exclamation-circle text-warning"></i>
                            <i *ngIf="item.isRejected === true" class="fas fa-exclamation-circle text-danger"></i>
                            {{item.dateOfFlight | date:'dd/MM/yy HH:mm'}}
                            Статус: <span [ngSwitch]="item?.flightStep?.step">
                                <span  *ngSwitchCase="FlightSteps.START">Старт</span>
                                <span  *ngSwitchCase="FlightSteps.FLIGHT">Політ</span>
                                <span  *ngSwitchCase="FlightSteps.LBZ_FORWARD">ЛБЗ ВПЕРЕД</span>
                                <span  *ngSwitchCase="FlightSteps.RETURN">Повернення</span>
                                <span  *ngSwitchCase="FlightSteps.LBZ_HOME">ЛБЗ назад</span>
                                <span  *ngSwitchCase="FlightSteps.REDUCTION">Початок зниження</span>
                                <span *ngSwitchCase="FlightSteps.END">Кінець</span>
                            </span>
                             
                            
                        </a>
                    </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="slimScrollBar"
            style="background: rgb(0, 0, 0); width: 7px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 995.4px;">
        </div>
        <div class="slimScrollRail"
            style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 1px;">
        </div>
    </div>
</div>

<div class="dashboard-wrapper">
    <div class="dashboard-ecommerce">
        <div class="container-fluid dashboard-content ">

            <div *ngIf="flight.isRejected === true" class="row">
                <div class="alert alert-danger w-100 mb-0" role="alert">
                    <h5 *ngIf="flight.isRejectedbyPPO">Заборонено ППО:</h5>
                    <h5 *ngIf="flight.isRejectedbyREB">Заборонено РЕБ:</h5>
                    <div>
                        Причина: {{flight.rejectedReason}}
                    </div>
                    <div class="mt-2">
                        <button (click)="terminateFlight(false)" class="btn btn-success w-100">Зрозуміло</button>
                    </div>
                </div>
            </div>

            <div *ngIf="!flight.isRejected" class="row">
                <div class="col-12">
                    <div class="section-block">
                        <h4 class="section-title">{{isNewFlight ? 'Створення нового вильоту' : 'Відредагувати виліт'}}</h4>
                    </div>
                    <div class="tab-regular">
                        <ul class="nav nav-tabs " id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active p-2" id="home-tab" data-toggle="tab" href="#start" role="tab"
                                    aria-controls="home" aria-selected="true">
                                    Загальна інформація
                                    <i class="fas fa-check-circle text-success"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link p-2" id="profile-tab" aria-disabled="true" data-toggle="tab"
                                    href="#flight" role="tab" aria-controls="profile" aria-selected="false">
                                    Взліт

                                    <i *ngIf="flight.flightStep.step! >= FlightSteps.START && flight.flightStep.isApproved === true"
                                        class="fas fa-check-circle text-success"></i>
                                    <i *ngIf="flight.flightStep.step! < FlightSteps.START || flight.flightStep.isApproved === false"
                                        class="fas fa-exclamation-circle text-danger"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link p-2" id="contact-tab" data-toggle="tab" href="#lbz" role="tab"
                                    aria-controls="contact" aria-selected="false">
                                    ЛБЗ Вперед

                                    <i *ngIf="flight.flightStep.step! >= FlightSteps.FLIGHT && flight.flightStep.isApproved === true"
                                        class="fas fa-check-circle text-success"></i>
                                    <i *ngIf="flight.flightStep.step! < FlightSteps.FLIGHT || flight.flightStep.isApproved === false"
                                        class="fas fa-exclamation-circle text-danger"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link p-2" id="contact-tab" data-toggle="tab" href="#return" role="tab"
                                    aria-controls="contact" aria-selected="false">
                                    Повернення
                                    <i *ngIf="flight.flightStep.step! >= FlightSteps.LBZ_FORWARD && flight.flightStep.isApproved === true"
                                        class="fas fa-check-circle text-success"></i>
                                    <i *ngIf="flight.flightStep.step! < FlightSteps.LBZ_FORWARD || flight.flightStep.isApproved === false"
                                        class="fas fa-exclamation-circle text-danger"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link p-2" id="contact-tab" data-toggle="tab" href="#lbzhome" role="tab"
                                    aria-controls="contact" aria-selected="false">
                                    ЛБЗ Назад
                                    <i *ngIf="flight.flightStep.step! >= FlightSteps.RETURN && flight.flightStep.isApproved === true"
                                        class="fas fa-check-circle text-success"></i>
                                    <i *ngIf="flight.flightStep.step! < FlightSteps.RETURN || flight.flightStep.isApproved === false"
                                        class="fas fa-exclamation-circle text-danger"></i>
                                </a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link p-2" id="contact-tab" data-toggle="tab" href="#reduction" role="tab"
                                    aria-controls="contact" aria-selected="false">
                                    Початок зниження
                                    <i *ngIf="flight.flightStep.step! >= FlightSteps.LBZ_HOME && flight.flightStep.isApproved === true"
                                        class="fas fa-check-circle text-success"></i>
                                    <i *ngIf="flight.flightStep.step! < FlightSteps.LBZ_HOME || flight.flightStep.isApproved === false"
                                        class="fas fa-exclamation-circle text-danger"></i>
                                </a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link p-2" id="contact-tab" data-toggle="tab" href="#end" role="tab"
                                    aria-controls="contact" aria-selected="false">
                                    Завершення
                                    <i *ngIf="flight.flightStep.step! >= FlightSteps.REDUCTION && flight.flightStep.isApproved === true"
                                        class="fas fa-check-circle text-success"></i>
                                    <i *ngIf="flight.flightStep.step! < FlightSteps.REDUCTION || flight.flightStep.isApproved === false"
                                        class="fas fa-exclamation-circle text-danger"></i>
                                </a>
                            </li>

                            <li *ngIf="flight.flightStep.isApproved === true" class="nav-item">
                                <button class="btn p-2 btn-danger" (click)="terminateFlight(true)">
                                    <i class="fas fa-exclamation-circle text-warning"></i>
                                        Екстренне завершення
                                    </button>
                            </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                            <!-- ЗАГАЛЬНА ІНФОРМАЦІЯ -->
                            <div class="tab-pane fade show active" id="start" role="tabpanel"
                                aria-labelledby="home-tab">

                                <div class="row">
                                    <div class="col-12">
                                        <label required class="col-form-label">Оператор</label>
                                        <input [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.operator" type="text" class="form-control">
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-6">
                                        <label class="col-form-label">Телефон Оператора</label>
                                        <input [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.operatorPhone" type="text" class="form-control"
                                            mask='(000) 000-0000'>
                                    </div>

                                    <div class="col-6">
                                        <label class="col-form-label">Телефон Навідника</label>
                                        <input [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.spotterPhone" type="text" class="form-control"
                                            mask='(000) 000-0000'>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-6">
                                        <label class="col-form-label">Призначення дрону</label>
                                        <ng-select [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.assignment">
                                            <ng-option *ngFor="let item of options.dronAppointment" [value]="item">
                                                <span [style.backgroundColor]="item.color"
                                                    class="badge">{{item.name}}</span>
                                            </ng-option>
                                        </ng-select>
                                    </div>
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Модель дрону</label>
                                            <ng-select [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.model">
                                                <ng-option *ngFor="let item of options.dronModels" [value]="item">
                                                    <span [style.backgroundColor]="item.color"
                                                        class="badge">{{item.name}}</span>
                                                </ng-option>
                                            </ng-select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Д/Ч керування</label>
                                            <input [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Д/Ч відео</label>
                                            <input [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" type="text" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">Дата вильоту</label>
                                            <input *ngIf="!flight.dateOfFlight" [ngModel]="dateNow | date:'yyyy-MM-dd HH:mm'"
                                                type="datetime-local" disabled="true" class="form-control">
                                            <input *ngIf="flight.dateOfFlight" [ngModel]="flight.dateOfFlight | date:'yyyy-MM-dd HH:mm'"
                                                type="datetime-local" disabled="true" class="form-control">
                                        </div>
                                    </div>
                                </div>



                                <div class="row">
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Маршрут вперед</label>
                                            <input [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.routeForward" type="text" class="form-control">
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Маршрут повернення</label>
                                            <input [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.routeBack" type="text" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">Діскорд</label>
                                            <div class="alert alert-secondary">
                                                <a target="_blank" [href]="flight.discordUrl">
                                                    {{flight.discordUrl}}
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <label class="custom-control custom-checkbox">
                                            <input required [disabled]="flight.flightStep.step != FlightSteps.START || ( flight.flightStep.step == FlightSteps.START && flight.flightStep.isApproved == true)" [(ngModel)]="flight.isInDiscord" type="checkbox" checked=""
                                                class="custom-control-input">
                                            <span class="custom-control-label">
                                                Зайшов у Діскорд <b>(обов'язково)</b>
                                            </span>
                                        </label>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="mt-3 d-flex justify-content-end">
                                            <button *ngIf="!flight._id" [disabled]="validateStep(FlightSteps.START)" (click)="createFlight()" href="#" class="btn btn-success">
                                                Створити політ
                                                <i class="fas fa-arrow-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>


                            </div>

                            <!-- ВИЛІТ -->
                            <div class="tab-pane fade" id="flight" role="tabpanel" aria-labelledby="profile-tab">

                                <div class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">Дата вильоту</label>
                                
                                            <input *ngIf="!flight.flightStartDate" [ngModel]="dateNow | date:'yyyy-MM-dd HH:mm'" type="datetime-local"
                                                disabled="true" class="form-control">
                                            <input *ngIf="flight.flightStartDate" [ngModel]="flight.flightStartDate | date:'yyyy-MM-dd HH:mm'"
                                                type="datetime-local" disabled="true" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="mt-3 d-flex justify-content-end">
                                            <button
                                                [disabled]="flight.flightStep.step !== FlightSteps.START || flight.flightStep.isApproved === false"
                                                class="btn btn-success" (click)="next()">
                                                Виліт
                                                <i class="fas fa-arrow-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- ЛБЗ ВПЕРЕД -->
                            <div class="tab-pane fade" id="lbz" role="tabpanel" aria-labelledby="contact-tab">
                                <div class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">ЛБЗ Вперед час</label>

                                            <input *ngIf="!flight.LBZForwardDate" [ngModel]="dateNow | date:'yyyy-MM-dd HH:mm'" type="datetime-local"
                                                disabled="true" class="form-control">
                                            <input *ngIf="flight.LBZForwardDate" [ngModel]="flight.LBZForwardDate | date:'yyyy-MM-dd HH:mm'"
                                                type="datetime-local" disabled="true" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="mt-3 d-flex justify-content-end">
                                            <button
                                                [disabled]="flight.flightStep.step !== FlightSteps.FLIGHT"
                                                 class="btn btn-success" (click)="next()">
                                                ЛБЗ Вперед
                                                <i class="fas fa-arrow-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ПОВЕРНЕННЯ -->
                            <div class="tab-pane fade" id="return" role="tabpanel" aria-labelledby="contact-tab">
                                <div class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">Повернення час</label>

                                            <input *ngIf="!flight.returnDate" [ngModel]="dateNow | date:'yyyy-MM-dd HH:mm'" type="datetime-local"
                                                disabled="true" class="form-control">
                                            <input *ngIf="flight.returnDate" [ngModel]="flight.returnDate | date:'yyyy-MM-dd HH:mm'"
                                                type="datetime-local" disabled="true" class="form-control">

                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label class="custom-control custom-checkbox">
                                            <input [disabled]="flight.flightStep.step != FlightSteps.LBZ_FORWARD" [(ngModel)]="flight.isReturnChanged" type="checkbox" checked=""
                                                class="custom-control-input">
                                            <span class="custom-control-label">
                                                Марштур змінився
                                            </span>
                                        </label>
                                    </div>
                                </div>

                                <div *ngIf="flight.isReturnChanged === true" class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">Інформація про зміну маршруту</label>
                                            <input [disabled]="flight.flightStep.step != FlightSteps.LBZ_FORWARD" [(ngModel)]="flight.changedReturnRoute" type="text" class="form-control">
                                        </div>
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-12">
                                        <div class="mt-3 d-flex justify-content-end">
                                            <button
                                                [disabled]="flight.flightStep.step !== FlightSteps.LBZ_FORWARD"
                                                 class="btn btn-success" (click)="next()">
                                                 Повернення
                                                <i class="fas fa-arrow-right"></i>
                                            </button>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ЛБЗ ДОДОМУ -->
                            <div class="tab-pane fade" id="lbzhome" role="tabpanel" aria-labelledby="contact-tab">
                                <div class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">ЛБЗ назад час</label>
                                            
                                            <input *ngIf="!flight.LBZBackDate" [ngModel]="dateNow | date:'yyyy-MM-dd HH:mm'" type="datetime-local"
                                                disabled="true" class="form-control">
                                            <input *ngIf="flight.LBZBackDate" [ngModel]="flight.LBZBackDate | date:'yyyy-MM-dd HH:mm'"
                                                type="datetime-local" disabled="true" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="mt-3 d-flex justify-content-end">

                                            <button
                                                [disabled]="flight.flightStep.step !== FlightSteps.RETURN"
                                                 class="btn btn-success" (click)="next()">
                                                 ЛБЗ Назад
                                                <i class="fas fa-arrow-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ПОЧАТОК ЗНИЖЕННЯ -->
                            <div class="tab-pane fade" id="reduction" role="tabpanel" aria-labelledby="contact-tab">
                                <div class="row">
                                    <div class="col-12">
                                        <div>
                                            <label class="col-form-label">Початок зниження час</label>
                                            
                                            <input *ngIf="!flight.reductionDate" [ngModel]="dateNow | date:'yyyy-MM-dd HH:mm'" type="datetime-local"
                                                disabled="true" class="form-control">
                                            <input *ngIf="flight.reductionDate" [ngModel]="flight.reductionDate | date:'yyyy-MM-dd HH:mm'"
                                                type="datetime-local" disabled="true" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Дистанція (в км.)</label>
                                            <input [disabled]="flight.flightStep.step != FlightSteps.LBZ_HOME" [(ngModel)]="flight.reductionDistance" type="number" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Населений пункт</label>
                                            <input [disabled]="flight.flightStep.step != FlightSteps.LBZ_HOME" [(ngModel)]="flight.reductionLocation" type="text" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="mt-3 d-flex justify-content-end">

                                            <button
                                                [disabled]="flight.flightStep.step !== FlightSteps.LBZ_HOME"
                                                 class="btn btn-success" (click)="next()">
                                                 Початок зниження
                                                <i class="fas fa-arrow-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ЗАВЕРШЕННЯ -->
                            <div class="tab-pane fade" id="end" role="tabpanel" aria-labelledby="contact-tab">
                                <div class="row">
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Завершення</label>
                                            <input disabled="true" type="datetime-local"
                                                [ngModel]="dateNow | date:'yyyy-MM-dd HH:mm'" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div>
                                            <label class="col-form-label">Повернення</label>
                                            <ng-select [(ngModel)]="flight.boardingStatus">
                                                <ng-option *ngFor="let item of options.boardingStatuses" [value]="item.name">
                                                    <span [style.backgroundColor]="item.color"
                                                        class="badge">{{item.name}}</span>
                                                </ng-option>
                                            </ng-select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="mt-3 d-flex justify-content-end">
                                                <button
                                                [disabled]="flight.flightStep.step !== FlightSteps.REDUCTION"
                                                 class="btn btn-success" (click)="next()">
                                                 Завершити
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>